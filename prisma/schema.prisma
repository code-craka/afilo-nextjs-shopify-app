generator client {
  provider = "prisma-client-js"
  // Note: driverAdapters is now stable in Prisma 6.18+, no longer needs previewFeatures
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_collection_products {
  product_id          String              @db.Uuid
  collection_id       String              @db.Uuid
  position            Int?                @default(0)
  created_at          DateTime?           @default(now()) @db.Timestamptz(6)
  product_collections product_collections @relation(fields: [collection_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products            products            @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([product_id, collection_id])
  @@index([collection_id], map: "idx_collection_products_collection")
  @@index([product_id], map: "idx_collection_products_product")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_collections {
  id                          String                        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  handle                      String                        @unique
  title                       String
  description                 String?
  description_html            String?
  image_url                   String?
  seo_title                   String?
  seo_description             String?
  status                      String                        @default("active")
  created_at                  DateTime?                     @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime?                     @default(now()) @db.Timestamptz(6)
  product_collection_products product_collection_products[]

  @@index([handle], map: "idx_collections_handle")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_pricing_tiers {
  id                  String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id          String            @db.Uuid
  variant_id          String?           @db.Uuid
  tier_name           String
  minimum_quantity    Int               @default(1)
  maximum_quantity    Int?
  price               Decimal           @db.Decimal(10, 2)
  discount_percentage Decimal?          @default(0) @db.Decimal(5, 2)
  features            String[]          @default([])
  user_limits         Json?             @default("{\"maximum\": 999, \"minimum\": 1}")
  created_at          DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?         @default(now()) @db.Timestamptz(6)
  products            products          @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants    product_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([product_id], map: "idx_pricing_tiers_product")
  @@index([variant_id], map: "idx_pricing_tiers_variant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_variants {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id            String                  @db.Uuid
  title                 String
  sku                   String?                 @unique
  license_type          String
  max_seats             Int                     @default(1)
  license_terms         Json                    @default("{\"teamUse\": false, \"commercialUse\": false, \"extendedSupport\": false, \"sourceCodeIncluded\": false, \"customizationAllowed\": true, \"redistributionAllowed\": false}")
  price                 Decimal                 @db.Decimal(10, 2)
  price_multiplier      Decimal                 @default(1.00) @db.Decimal(5, 2)
  compare_at_price      Decimal?                @db.Decimal(10, 2)
  stripe_price_id       String?                 @unique
  available_for_sale    Boolean?                @default(true)
  quantity_available    Int?
  position              Int?                    @default(0)
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?               @default(now()) @db.Timestamptz(6)
  product_pricing_tiers product_pricing_tiers[]
  products              products                @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([license_type], map: "idx_variants_license_type")
  @@index([product_id], map: "idx_variants_product_id")
  @@index([sku], map: "idx_variants_sku")
  @@index([stripe_price_id], map: "idx_variants_stripe_price_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model products {
  id                           String                        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  handle                       String                        @unique
  title                        String
  description                  String                        @default("")
  description_html             String?
  base_price                   Decimal                       @db.Decimal(10, 2)
  currency                     String                        @default("USD")
  compare_at_price             Decimal?                      @db.Decimal(10, 2)
  product_type                 String
  vendor                       String                        @default("Afilo")
  tags                         String[]                      @default([])
  tech_stack                   String[]                      @default([])
  version                      String?
  available_licenses           Json                          @default("[\"Personal\", \"Commercial\", \"Enterprise\"]")
  subscription_supported       Boolean?                      @default(false)
  subscription_interval        String?
  trial_period_days            Int?                          @default(0)
  minimum_users                Int?                          @default(1)
  maximum_users                Int?
  compliance_standards         String[]                      @default([])
  integration_capabilities     String[]                      @default([])
  support_level                String?                       @default("standard")
  has_documentation            Boolean?                      @default(false)
  has_demo                     Boolean?                      @default(false)
  demo_url                     String?
  documentation_url            String?
  system_requirements          Json?                         @default("{}")
  download_links               String[]                      @default([])
  access_instructions          String?
  activation_required          Boolean?                      @default(false)
  stripe_product_id            String?                       @unique
  stripe_price_id              String?
  stripe_subscription_price_id String?
  available_for_sale           Boolean?                      @default(true)
  featured                     Boolean?                      @default(false)
  status                       String                        @default("active")
  featured_image_url           String?
  images                       Json?                         @default("[]")
  seo_title                    String?
  seo_description              String?
  created_at                   DateTime?                     @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime?                     @default(now()) @db.Timestamptz(6)
  published_at                 DateTime?                     @db.Timestamptz(6)
  product_collection_products  product_collection_products[]
  product_pricing_tiers        product_pricing_tiers[]
  product_variants             product_variants[]

  @@index([created_at(sort: Desc)], map: "idx_products_created_at")
  @@index([handle], map: "idx_products_handle")
  @@index([product_type], map: "idx_products_product_type")
  @@index([stripe_product_id], map: "idx_products_stripe_product_id")
  @@index([tags], map: "idx_products_tags", type: Gin)
  @@index([tech_stack], map: "idx_products_tech_stack", type: Gin)
  @@index([updated_at(sort: Desc)], map: "idx_products_updated_at")
  @@index([vendor], map: "idx_products_vendor")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cart_items {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String
  product_id        String
  variant_id        String
  title             String
  price             Decimal   @db.Decimal(10, 2)
  quantity          Int       @default(1)
  license_type      String
  image_url         String?
  status            String    @default("active")
  added_at          DateTime? @default(now()) @db.Timestamptz(6)
  last_modified     DateTime? @default(now()) @db.Timestamptz(6)
  abandoned_at      DateTime? @db.Timestamptz(6)
  purchased_at      DateTime? @db.Timestamptz(6)
  stripe_session_id String?
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  updated_at        DateTime? @default(now()) @db.Timestamptz(6)

  @@index([created_at], map: "idx_cart_items_created_at")
  @@index([product_id, variant_id], map: "idx_cart_items_product")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model downloads {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerk_user_id   String
  subscription_id String?        @db.Uuid
  product_id      String
  product_title   String
  download_url    String
  license_key     String?
  download_count  Int?           @default(0)
  max_downloads   Int?           @default(10)
  expires_at      DateTime?      @db.Timestamp(6)
  created_at      DateTime?      @default(now()) @db.Timestamp(6)
  subscriptions   subscriptions? @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([clerk_user_id], map: "idx_downloads_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model subscriptions {
  id                   String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerk_user_id        String
  email                String
  shopify_order_id     String?
  plan_id              String
  status               String
  current_period_start DateTime    @db.Timestamp(6)
  current_period_end   DateTime    @db.Timestamp(6)
  cancel_at_period_end Boolean?    @default(false)
  created_at           DateTime?   @default(now()) @db.Timestamp(6)
  updated_at           DateTime?   @default(now()) @db.Timestamp(6)
  downloads            downloads[]

  @@index([clerk_user_id], map: "idx_subscriptions_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model unified_products {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String    @db.VarChar(255)
  description          String?
  base_price           Int
  currency             String?   @default("USD") @db.VarChar(3)
  shopify_product_id   String?   @unique(map: "unique_shopify_product") @db.VarChar(255)
  shopify_variant_id   String?   @db.VarChar(255)
  shopify_handle       String?   @db.VarChar(255)
  shopify_synced_at    DateTime? @db.Timestamptz(6)
  stripe_product_id    String?   @unique(map: "unique_stripe_product") @db.VarChar(255)
  stripe_price_monthly String?   @db.VarChar(255)
  stripe_price_annual  String?   @db.VarChar(255)
  stripe_synced_at     DateTime? @db.Timestamptz(6)
  features             Json?     @default("[]")
  metadata             Json?     @default("{}")
  images               Json?     @default("[]")
  available_on_shopify Boolean?  @default(true)
  available_on_stripe  Boolean?  @default(false)
  active               Boolean?  @default(true)
  tier                 String?   @db.VarChar(50)
  user_limit           String?   @db.VarChar(50)
  product_type         String?   @db.VarChar(100)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_activity_log {
  id              Int            @id @default(autoincrement())
  user_profile_id Int?
  activity_type   String         @db.VarChar(50)
  activity_data   Json?
  ip_address      String?        @db.Inet
  user_agent      String?
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  user_profiles   user_profiles? @relation(fields: [user_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([activity_type], map: "idx_user_activity_log_activity_type")
  @@index([created_at], map: "idx_user_activity_log_created_at")
  @@index([user_profile_id], map: "idx_user_activity_log_user_profile_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_profiles {
  id                 Int                  @id @default(autoincrement())
  clerk_user_id      String               @unique @db.VarChar(255)
  email              String?              @db.VarChar(255)
  first_name         String?              @db.VarChar(255)
  last_name          String?              @db.VarChar(255)
  oauth_signup       Boolean?             @default(false)
  subscription_tier  String?              @default("free") @db.VarChar(50)
  company            String?              @db.VarChar(255)
  job_title          String?              @db.VarChar(255)
  phone              String?              @db.VarChar(50)
  avatar_url         String?
  last_login         DateTime?            @db.Timestamptz(6)
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  role               String?              @default("standard") @db.VarChar(20)
  purchase_type      String?              @db.VarChar(20)
  user_activity_log  user_activity_log[]
  user_subscriptions user_subscriptions[]

  @@index([clerk_user_id], map: "idx_user_profiles_clerk_user_id")
  @@index([created_at], map: "idx_user_profiles_created_at")
  @@index([email], map: "idx_user_profiles_email")
  @@index([role], map: "idx_user_profiles_role")
  @@index([subscription_tier], map: "idx_user_profiles_subscription_tier")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_subscriptions {
  id                      Int            @id @default(autoincrement())
  user_profile_id         Int?
  subscription_tier       String         @db.VarChar(50)
  price_paid              Decimal?       @db.Decimal(10, 2)
  billing_period          String?        @db.VarChar(20)
  start_date              DateTime       @db.Timestamptz(6)
  end_date                DateTime?      @db.Timestamptz(6)
  status                  String?        @default("active") @db.VarChar(20)
  shopify_subscription_id String?        @db.VarChar(255)
  created_at              DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?      @default(now()) @db.Timestamptz(6)
  user_profiles           user_profiles? @relation(fields: [user_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([shopify_subscription_id], map: "idx_user_subscriptions_shopify_id")
  @@index([status], map: "idx_user_subscriptions_status")
  @@index([user_profile_id], map: "idx_user_subscriptions_user_profile_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model chat_conversations {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerk_user_id   String          @db.VarChar(255)
  title           String?         @db.VarChar(500)
  status          String          @default("active") @db.VarChar(50)
  created_at      DateTime        @default(now()) @db.Timestamptz(6)
  updated_at      DateTime        @default(now()) @db.Timestamptz(6)
  last_message_at DateTime        @default(now()) @db.Timestamptz(6)
  chat_messages   chat_messages[]
  bot_analytics   bot_analytics[]

  @@index([clerk_user_id], map: "idx_chat_conversations_user")
  @@index([status], map: "idx_chat_conversations_status")
  @@index([created_at], map: "idx_chat_conversations_created_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model chat_messages {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversation_id  String             @db.Uuid
  role             String             @db.VarChar(20)
  content          String             @db.Text
  metadata         Json?              @default("{}")
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  conversation     chat_conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([conversation_id], map: "idx_chat_messages_conversation")
  @@index([created_at], map: "idx_chat_messages_created_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model knowledge_base {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  url             String    @unique @db.Text
  title           String?   @db.VarChar(500)
  content         String    @db.Text
  content_type    String?   @db.VarChar(50)
  embedding       String?   @db.Text // Will be vector(1536) after migration
  searchable_text String?   @db.Text // Will be tsvector after migration
  metadata        Json?     @default("{}")
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime  @default(now()) @db.Timestamptz(6)

  @@index([content_type], map: "idx_knowledge_base_content_type")
  @@index([created_at], map: "idx_knowledge_base_created_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bot_analytics {
  id              String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversation_id String?             @db.Uuid
  event_type      String              @db.VarChar(100)
  event_data      Json?               @default("{}")
  created_at      DateTime            @default(now()) @db.Timestamptz(6)
  conversation    chat_conversations? @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([conversation_id], map: "idx_bot_analytics_conversation")
  @@index([event_type], map: "idx_bot_analytics_event_type")
  @@index([created_at], map: "idx_bot_analytics_created_at")
}

/// Cart Recovery System Models - Phase 2 Feature
model cart_recovery_campaigns {
  id                   String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String                     @db.VarChar(255)
  description          String?
  is_active            Boolean                    @default(true)
  trigger_delay_hours  Int                        @default(24)
  email_template       String
  subject_line         String                     @db.VarChar(255)
  discount_percent     Decimal                    @default(0) @db.Decimal(5, 2)
  discount_code        String?                    @db.VarChar(50)
  total_sent           Int                        @default(0)
  total_opened         Int                        @default(0)
  total_clicked        Int                        @default(0)
  total_converted      Int                        @default(0)
  total_revenue        Decimal                    @default(0) @db.Decimal(10, 2)
  created_at           DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at           DateTime                   @default(now()) @db.Timestamptz(6)
  email_logs           cart_recovery_email_logs[]
}

model cart_recovery_sessions {
  id                        String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cart_session_id           String                     @db.VarChar(255)
  clerk_user_id             String                     @db.VarChar(255)
  user_email                String                     @db.VarChar(255)
  user_name                 String?                    @db.VarChar(255)
  total_items               Int                        @default(0)
  total_value               Decimal                    @default(0) @db.Decimal(10, 2)
  cart_data                 Json?
  created_at                DateTime                   @default(now()) @db.Timestamptz(6)
  abandoned_at              DateTime?                  @db.Timestamptz(6)
  last_activity             DateTime                   @default(now()) @db.Timestamptz(6)
  status                    String                     @default("active") @db.VarChar(50)
  recovery_emails_sent      Int                        @default(0)
  last_email_sent_at        DateTime?                  @db.Timestamptz(6)
  recovered_at              DateTime?                  @db.Timestamptz(6)
  email_opened              Boolean                    @default(false)
  email_clicked             Boolean                    @default(false)
  recovery_discount_used    Boolean                    @default(false)
  recovery_revenue          Decimal                    @default(0) @db.Decimal(10, 2)
  email_logs                cart_recovery_email_logs[]

  @@unique([cart_session_id, clerk_user_id])
  @@index([clerk_user_id], map: "idx_cart_recovery_sessions_user")
  @@index([status], map: "idx_cart_recovery_sessions_status")
  @@index([abandoned_at], map: "idx_cart_recovery_sessions_abandoned")
  @@index([created_at], map: "idx_cart_recovery_sessions_created")
}

model cart_recovery_email_logs {
  id                  String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  recovery_session_id String                   @db.Uuid
  campaign_id         String                   @db.Uuid
  recipient_email     String                   @db.VarChar(255)
  subject_line        String                   @db.VarChar(255)
  email_content       String?
  discount_code       String?                  @db.VarChar(50)
  sent_at             DateTime                 @default(now()) @db.Timestamptz(6)
  opened_at           DateTime?                @db.Timestamptz(6)
  clicked_at          DateTime?                @db.Timestamptz(6)
  converted_at        DateTime?                @db.Timestamptz(6)
  delivery_status     String                   @default("sent") @db.VarChar(50)
  error_message       String?
  cart_value_at_send  Decimal?                 @db.Decimal(10, 2)
  recovery_revenue    Decimal                  @default(0) @db.Decimal(10, 2)
  session             cart_recovery_sessions   @relation(fields: [recovery_session_id], references: [id], onDelete: Cascade)
  campaign            cart_recovery_campaigns  @relation(fields: [campaign_id], references: [id], onDelete: Cascade)

  @@index([recovery_session_id], map: "idx_cart_recovery_email_logs_session")
  @@index([campaign_id], map: "idx_cart_recovery_email_logs_campaign")
  @@index([sent_at], map: "idx_cart_recovery_email_logs_sent")
  @@index([delivery_status], map: "idx_cart_recovery_email_logs_status")
}

model cart_recovery_analytics {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  date              DateTime  @unique @db.Date
  carts_abandoned   Int       @default(0)
  carts_recovered   Int       @default(0)
  emails_sent       Int       @default(0)
  emails_opened     Int       @default(0)
  emails_clicked    Int       @default(0)
  potential_revenue Decimal   @default(0) @db.Decimal(10, 2)
  recovered_revenue Decimal   @default(0) @db.Decimal(10, 2)
  recovery_rate     Decimal   @default(0) @db.Decimal(5, 2)
  open_rate         Decimal   @default(0) @db.Decimal(5, 2)
  click_rate        Decimal   @default(0) @db.Decimal(5, 2)
  conversion_rate   Decimal   @default(0) @db.Decimal(5, 2)
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  updated_at        DateTime  @default(now()) @db.Timestamptz(6)

  @@index([date], map: "idx_cart_recovery_analytics_date")
}

// ========================================
// ENTERPRISE INTEGRATIONS (Phase 2)
// ========================================

/// Webhook events log for monitoring and debugging
model webhook_events {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  source          String            @default("stripe") // stripe, github, slack, etc.
  event_type      String            // payment_intent.succeeded, push, etc.
  event_id        String?           // External event ID
  payload         Json              // Raw webhook payload
  headers         Json?             // Request headers for debugging
  status          String            @default("received") // received, processing, completed, failed
  processing_time Int?              // Milliseconds to process
  error_message   String?           // Error details if processing failed
  retry_count     Int               @default(0)
  processed_at    DateTime?         @db.Timestamptz(6)
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  updated_at      DateTime          @default(now()) @db.Timestamptz(6)

  @@index([source], map: "idx_webhook_events_source")
  @@index([event_type], map: "idx_webhook_events_type")
  @@index([status], map: "idx_webhook_events_status")
  @@index([created_at], map: "idx_webhook_events_created")
}

/// API endpoint monitoring and performance tracking
model api_monitoring {
  id                String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  endpoint          String            // /api/stripe/webhook, /api/billing/*, etc.
  method            String            // GET, POST, PUT, DELETE
  status_code       Int               // 200, 404, 500, etc.
  response_time     Int               // Milliseconds
  request_size      Int?              // Bytes
  response_size     Int?              // Bytes
  user_agent        String?           // Client information
  ip_address        String?           // Request IP (anonymized)
  clerk_user_id     String?           // User making request
  error_message     String?           // Error details for failed requests
  trace_id          String?           // Unique request identifier
  created_at        DateTime          @default(now()) @db.Timestamptz(6)

  @@index([endpoint], map: "idx_api_monitoring_endpoint")
  @@index([status_code], map: "idx_api_monitoring_status")
  @@index([created_at], map: "idx_api_monitoring_created")
  @@index([clerk_user_id], map: "idx_api_monitoring_user")
}

/// Rate limiting tracking and enforcement
model rate_limit_tracking {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  identifier      String            // IP address, user ID, API key
  identifier_type String            @default("ip") // ip, user, api_key
  endpoint        String            // Specific endpoint or * for global
  current_count   Int               @default(1)
  limit_count     Int               // Maximum allowed requests
  window_start    DateTime          @db.Timestamptz(6)
  window_end      DateTime          @db.Timestamptz(6)
  blocked_until   DateTime?         @db.Timestamptz(6) // If temporarily blocked
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  updated_at      DateTime          @default(now()) @db.Timestamptz(6)

  @@unique([identifier, endpoint, window_start], map: "unique_rate_limit_window")
  @@index([identifier], map: "idx_rate_limit_identifier")
  @@index([endpoint], map: "idx_rate_limit_endpoint")
  @@index([window_end], map: "idx_rate_limit_window_end")
}

/// System audit logs for security and compliance
model audit_logs {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  action          String            // login, payment, admin_action, data_export, etc.
  resource        String?           // user_profile, subscription, product, etc.
  resource_id     String?           // ID of affected resource
  clerk_user_id   String?           // User performing action
  admin_user_id   String?           // Admin performing action (for admin actions)
  ip_address      String?           // Source IP address
  user_agent      String?           // Browser/client info
  details         Json?             // Additional context and metadata
  risk_score      Int?              @default(0) // 0-100, calculated risk level
  flagged         Boolean           @default(false) // Requires review
  reviewed_by     String?           // Admin who reviewed flagged action
  reviewed_at     DateTime?         @db.Timestamptz(6)
  created_at      DateTime          @default(now()) @db.Timestamptz(6)

  @@index([action], map: "idx_audit_logs_action")
  @@index([clerk_user_id], map: "idx_audit_logs_user")
  @@index([admin_user_id], map: "idx_audit_logs_admin")
  @@index([flagged], map: "idx_audit_logs_flagged")
  @@index([created_at], map: "idx_audit_logs_created")
  @@index([risk_score], map: "idx_audit_logs_risk")
}

/// Enterprise webhook configurations and management
model webhook_configurations {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name            String            // Human readable name
  url             String            // Webhook endpoint URL
  secret          String?           // Webhook signature secret
  events          String[]          // Array of event types to send
  is_active       Boolean           @default(true)
  retry_policy    Json?             // Retry configuration
  last_success    DateTime?         @db.Timestamptz(6)
  last_failure    DateTime?         @db.Timestamptz(6)
  failure_count   Int               @default(0)
  created_by      String            // Admin user ID who created
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  updated_at      DateTime          @default(now()) @db.Timestamptz(6)

  @@index([is_active], map: "idx_webhook_configs_active")
  @@index([created_by], map: "idx_webhook_configs_creator")
}

/// System performance metrics and health monitoring
model system_metrics {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  metric_name     String            // cpu_usage, memory_usage, db_connections, etc.
  metric_value    Float             // Numeric value
  metric_unit     String            @default("count") // percent, bytes, count, ms
  tags            Json?             // Additional metadata/labels
  recorded_at     DateTime          @default(now()) @db.Timestamptz(6)

  @@index([metric_name], map: "idx_system_metrics_name")
  @@index([recorded_at], map: "idx_system_metrics_time")
}
